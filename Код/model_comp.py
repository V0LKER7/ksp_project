import matplotlib.pyplot as plt
import math

# Реальные данные скорости
real_speeds = [
    0.0,
    0.001087785493828986, 0.0007549165026806765, 0.0006367788158368799, 
    0.000707072514350419, 0.09181143513170487, 4.779518514228627, 9.700351000719621, 
    14.720050143637454, 19.94404700736739, 25.16940687229754, 30.607017032299574, 
    36.15535289339172, 41.928618067185695, 47.706794568338125, 53.485019201688246, 
    59.37731974917996, 65.38554969497862, 71.75904569131369, 78.00941388274406, 
    84.50995135734836, 91.13885472606944, 97.88118593845631, 104.52336032880521, 
    111.32184544084257, 118.04083482239432, 124.89000670230782, 131.9617995950067, 
    139.16194432709855, 146.6207447446776, 154.17651476519066, 161.89469811155232, 
    169.7498609107471, 177.90463952548902, 186.04334151943107, 194.19697388464047, 
    202.32385661269095, 210.67456341185672, 219.40601689114743, 228.47523095741465, 
    238.0220446243192, 248.3730183265173, 258.97479207610377, 270.19660619729945, 
    281.80160572919203, 294.2702354598763, 307.53191195232097, 321.1107870292178, 
    335.58244529104667, 349.8895685465282, 364.57391807387296, 379.3449589715892, 
    393.87197022291997, 408.41321726707434, 423.2856931623815, 438.28804722199334, 
    453.5151289078717, 468.71412210823723, 484.19516784721105, 500.2814197540437, 
    516.3642853132164, 533.1259097286991, 549.9314658731357, 567.1019401641299, 
    584.6120431835714, 602.7894089366187, 620.9063267501031, 639.7050372260308, 
    658.8446171910282, 677.9618240377175, 697.4270352548363, 717.6586806315617, 
    738.2945586413778, 758.5224380310649, 780.0121674985903, 801.9651406286146, 
    823.951364592216, 846.408885084979, 869.3488328334447, 892.7827010458043, 
    917.206746334365, 941.6731746858198, 967.1715390635692, 992.7119653878767, 
    1018.2710114391863, 1044.9006291322703, 1072.0944200178603, 1100.4247279356578, 
    1123.844274705382, 1144.5405392613309, 1162.7517867194176, 1156.898184304832, 
    1154.1460936103651, 1159.1233613397246, 1164.494489161623, 1169.9251389483286, 
    1175.4283305466047, 1180.924393189036, 1186.5049303755234, 1192.2784595630212, 
    1198.2290465690407, 1203.7066715528608, 1209.7208962476625, 1215.8859215632979, 
    1222.0338614755467, 1228.3349679243536, 1234.6724705739302, 1240.9826012311412, 
    1247.3946635737932, 1253.9916904501947, 1260.624763730745, 1267.3270852795822, 
    1274.1196601629667, 1280.9780758755196, 1287.8792447388494, 1294.8369556210484, 
    1301.8706431443666, 1308.8312456894005, 1315.979896343719, 1323.18420035595, 
    1330.3057162672242
]

# Параметры для модели
g = 9.81  # Ускорение свободного падения

# Параметры S8 из KER
S8_thrust = 15541800  # Н
S8_isp = 230.7        # с
S8_burn_time = 86     # с

# Параметры S6 из KER
S6_thrust = 2937030   # Н
S6_isp = 241.2        # с
S6_burn_time = 70     # с

# Массы
mass_start = 1071570  # кг
mass_after_S8 = 354190  # кг (после отбрасывания S8)

# Расходы топлива (кг/с)
S8_mass_flow = S8_thrust / (S8_isp * g)  # ~6868.5 кг/с
S6_mass_flow = S6_thrust / (S6_isp * g)  # ~1241.4 кг/с

# Моделирование скорости
model_speeds = []
time_points = list(range(121))  # 121 точка: 0, 1, 2, ..., 120

# t = 0: скорость = 0
v = 0
model_speeds.append(v)

# Начинаем с t = 1
for t in range(1, 121):  # Для каждой секунды от 1 до 120
    # Определение активной ступени и параметров
    if t < S8_burn_time:  # Работает S8 (1-85 секунд)
        thrust = S8_thrust
        isp = S8_isp
        
        # Линейное уменьшение массы: m(t) = m_start - ṁ * t
        current_mass = mass_start - S8_mass_flow * t
        
        # Угол тангажа
        if t < 10:
            pitch_angle = 0 * math.pi / 180
        else:
            angle_deg = min(45, 0.5625 * (t - 10))
            pitch_angle = angle_deg * math.pi / 180
            
    elif t < S8_burn_time + S6_burn_time:  # Работает S6 (86-155 секунд)
        thrust = S6_thrust
        isp = S6_isp
        s6_time = t - S8_burn_time
        
        # Линейное уменьшение массы S6
        current_mass = mass_after_S8 - S6_mass_flow * s6_time
        
        # Угол продолжает увеличиваться
        angle_deg = min(60, 45 + 0.25 * s6_time)
        pitch_angle = angle_deg * math.pi / 180
        
    else:  # Все ступени отработали
        thrust = 0
        isp = 0
        S6_fuel_total = S6_mass_flow * S6_burn_time
        current_mass = mass_after_S8 - S6_fuel_total
        pitch_angle = 60 * math.pi / 180
    
    # Расчет ускорения
    if thrust > 0 and current_mass > 0:
        acceleration = thrust / current_mass
    else:
        acceleration = 0
    
    # Гравитационные потери
    gravity_loss = g * math.cos(pitch_angle)
    
    # Чистое ускорение
    net_acceleration = acceleration - gravity_loss
    
    # Приращение скорости за 1 секунду
    delta_v = net_acceleration * 1.0
    
    # Обновление скорости
    v += delta_v
    
    if v < 0:
        v = 0
    
    model_speeds.append(v)

# Построение графика сравнения
plt.figure(figsize=(14, 6))
plt.plot(time_points, real_speeds, 'g-', linewidth=2.5, alpha=0.8, label="график KSP")
plt.plot(time_points, model_speeds, 'b-', linewidth=2, alpha=0.9, label="программная реализация")
plt.ylabel("Скорость, м/с", fontsize=14)
plt.xlabel("Время, с", fontsize=14)
plt.legend()
plt.grid(True, alpha=0.3)
plt.xlim(0, 120)
plt.show()